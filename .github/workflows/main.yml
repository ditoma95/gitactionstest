# ğŸ§± Nom du workflow (il apparaÃ®tra dans l'onglet "Actions" de ton dÃ©pÃ´t GitHub)
name: Build, test and deploy

# ğŸš€ DÃ©clencheur du workflow : il s'exÃ©cutera Ã  chaque push sur la branche "main"
on:
  push:
    branches: [main]

# âš™ï¸ DÃ©finition des diffÃ©rents "jobs" (tÃ¢ches principales)
jobs:
  build:
    # ğŸ–¥ï¸ SpÃ©cifie sur quel systÃ¨me dâ€™exploitation exÃ©cuter le job (ici Ubuntu)
    runs-on: ubuntu-latest

    # ğŸ“‹ Liste des Ã©tapes Ã  exÃ©cuter dans ce job
    steps:
      # ğŸ§© Ã‰tape 1 : Cloner ton dÃ©pÃ´t GitHub dans la machine virtuelle
      - name: Checkout
        uses: actions/checkout@v4

      # ğŸ§° Ã‰tape 2 : Installer PHP dans lâ€™environnement
      # "shivammathur/setup-php@v2" est une action publique qui configure PHP
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.3 # ğŸ‘‰ version de PHP que tu veux utiliser

      # ğŸ’¾ Ã‰tape 3 : CrÃ©er une base de donnÃ©es SQLite vide pour les tests
      - name: Create database
        run: touch ./database/database.sqlite

      # âš™ï¸ Ã‰tape 4 : Copier le fichier dâ€™environnement de test (.env.test â†’ .env)
      # Cela permet de dÃ©finir les variables nÃ©cessaires Ã  Laravel (base de donnÃ©es, etc.)
      - name: Copy .env
        run: cp .env.test .env

      # ğŸ“¦ Ã‰tape 5 : Installer toutes les dÃ©pendances PHP (Composer)
      - name: Install app
        run: composer install

      # ğŸ§± Ã‰tape 6 : Lancer les migrations Laravel pour prÃ©parer la base de donnÃ©es
      - name: Run migrations
        run: php artisan migrate

      # ğŸ” Ã‰tape 7 : VÃ©rifier la qualitÃ© du code avec PHPStan (analyse statique)
      - name: Test PHPStan
        run: ./vendor/bin/phpstan analyse

      # ğŸ§ª Ã‰tape 8 : ExÃ©cuter les tests unitaires avec PHPUnit
      - name: Test PHPUnit
        run: ./vendor/bin/phpunit
